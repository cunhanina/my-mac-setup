#!/bin/zsh
source ~/bin/_styles.sh

# 1. Configuration
BASE_DIR="$HOME/Desktop/coding"
SEARCH_QUERY="$1"

# 2. Safety Check
if [ ! -d "$BASE_DIR" ]; then
    echo "${RED}âœ– Error: Coding folder not found at $BASE_DIR${RESET}" >&2
    exit 1
fi

# 3. List Mode (No argument)
if [ -z "$SEARCH_QUERY" ]; then
    header "ðŸ“‚ Projects in $(basename "$BASE_DIR")"
    
    # Find all folders (depth 1 and 2), exclude hidden ones
    find "$BASE_DIR" -maxdepth 2 -mindepth 1 -type d -not -path '*/.*' | \
    sed "s|$BASE_DIR/||" | \
    sort | \
    awk '{print "  ðŸ‘‰ " $0}' >&2
    exit 0
fi

# 4. Search Mode
# finding exact match first
TARGET=$(find "$BASE_DIR" -maxdepth 2 -type d -name "$SEARCH_QUERY" -print -quit)

# If no exact match, try partial match
if [ -z "$TARGET" ]; then
    TARGET=$(find "$BASE_DIR" -maxdepth 2 -type d -name "*$SEARCH_QUERY*" -print -quit)
fi

# 5. Result Handling
if [ -n "$TARGET" ]; then
    echo "$TARGET" 
    exit 0
else
    echo "${RED}âœ– Project '$SEARCH_QUERY' not found.${RESET}" >&2
    exit 1
fi
