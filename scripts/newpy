#!/bin/zsh
source ~/bin/_styles.sh

if [ -z "$1" ]; then
  err "Usage: newpy <project_name>"
  exit 1
fi

NAME=$1
# We keep new Python projects in the 'python' subfolder for organization
BASE_DIR="$HOME/Desktop/coding/python"
TARGET_DIR="$BASE_DIR/$NAME"

header "ðŸš€ Creating Private Project: $NAME"

# Ensure base folder
mkdir -p "$BASE_DIR"

if [ -d "$TARGET_DIR" ]; then
  err "Project '$NAME' already exists."
  exit 1
fi

mkdir "$TARGET_DIR"
cd "$TARGET_DIR"

# Initialize uv
uv init --app --name "$NAME" --quiet
uv add --dev ruff pytest black --quiet

# Structure
mkdir -p src tests
if [ -f "hello.py" ]; then mv hello.py src/main.py; else echo "print('Hello')" > src/main.py; fi

# To-Do Setup
echo "# ðŸ“ To-Do: $NAME\n\n- [ ] Initial setup complete\n- [ ] " > todo.md

# Git Setup
git init -q
curl -s https://raw.githubusercontent.com/github/gitignore/main/Python.gitignore > .gitignore
echo "\n# Local Notes\ntodo.md" >> .gitignore

git add .
git commit -m "Initial setup" -q

ok "Local project created."

# --- GITHUB AUTOMATION ---
if command -v gh &>/dev/null; then
    echo "  ðŸ”’ Creating PRIVATE repository on GitHub..."
    # Set to --private by default
    gh repo create "$NAME" --private --source=. --remote=origin --push
    ok "Live at https://github.com/cunhanina/$NAME (Private)"
else
    warn "GitHub CLI not found. Project is local only."
fi

# Open VS Code
if command -v code &>/dev/null; then
    code .
fi
