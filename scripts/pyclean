#!/bin/zsh
# Try to load styles, but don't crash if missing
[ -f ~/bin/_styles.sh ] && source ~/bin/_styles.sh

# --- SAFETY FALLBACKS ---
# If styles are missing, we define simple versions so the script works anywhere
if ! command -v header &> /dev/null; then
  header() { echo "\nðŸ§¹ $1"; }
  ok() { echo "  âœ” $1"; }
  info() { echo "  â„¹ï¸  $1"; }
fi
# ------------------------

# Default to current directory if no argument is given
TARGET_DIR="${1:-.}"

header "Deep Cleaning Python Project: $(pwd)"

# Function to find, count, and destroy
destroy() {
    local pattern="$1"
    local description="$2"
    
    # 1. Count matches (silencing errors)
    local count=$(find "$TARGET_DIR" -name "$pattern" 2>/dev/null | wc -l)
    
    # 2. If found, delete them
    if [ "$count" -gt 0 ]; then
        find "$TARGET_DIR" -name "$pattern" -exec rm -rf {} + 2>/dev/null
        # Trim whitespace from count for cleaner output
        ok "Removed $count $description ($pattern)"
    fi
}

# 1. Standard Python Junk
destroy "__pycache__" "bytecode folders"
destroy "*.pyc"       "compiled files"

# 2. Modern Tooling Caches (Ruff, Pytest, Mypy)
destroy ".pytest_cache" "test caches"
destroy ".ruff_cache"   "linter caches"
destroy ".mypy_cache"   "type check caches"
destroy ".coverage"     "coverage reports"

# 3. Build Artifacts (from packaging)
destroy "dist"        "distribution folders"
destroy "build"       "build folders"
destroy "*.egg-info"  "egg metadata"

# 4. OS Junk
destroy ".DS_Store"   "macOS metadata"

echo "" 
info "Sparkling clean. âœ¨"
